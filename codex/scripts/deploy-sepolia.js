const { ethers } = require("hardhat");

async function main() {
  console.log("üöÄ Starting deployment to Sepolia testnet...");

  // Get the deployer account
  const [deployer] = await ethers.getSigners();
  console.log("üìù Deploying contracts with account:", deployer.address);
  console.log("üí∞ Account balance:", ethers.formatEther(await deployer.provider.getBalance(deployer.address)), "ETH");

  // ASCII Art for complete BUGCAT collection
  const specialCodeLight = "+-+++-.--------+++++--.---+----+++++--------++++++++-.-------+++---.-#########-...----++++++-.---+++\n+-+++-.------.---+++--.----------++--.-.+----------+-.---------++--..#########-.-##------+++-.----+-\n+-----..----.+##+..........-----------####-----------.---------##+...+########-....-###-----...-----\n+--+++-------+####+----------.-----.+#####+.-----------------.-----+##########-++..-+---------------\n#--++++++++--+###++#+.-------.----+###++###.--------++++++++-.-++--#########--.------.--------++++++\n#------+++++-+###+++##+-----++++-##-#######--------------------+++-..#########---+---.-++++-----++++\n+------------+####+-##############++#######------------------+++-.-##############+++-.-----------+++\n+............-####+############+###+-++#+##--....-.....-##-++..-############+..............---------\n+++++-.-------##############################-..-.##+++#######--+#####++####--++++-++--+------.---+--\n+++++-.-------+###############+#############----+##################+++#+--.+##+-----++++++++-.-+++++\n+--++-.-------##################################++############+######+####+#####+--+###+++++---+++++\n+--++-.-----.##############################################################--++++++++---++---.--++++\n+----....-..-###+-#.+#########-#--+##############################+#########++++#+----..-----...-----\n+--++++++----###+-#+-########-+##+-##############################################--+++--------------\n+---++++++---#####+++########+---+#############################################++--###+-------++++++\n+---+--+++----#####################################+#########################+.+##---.---------+++++\n+------++++++++++####+---+#####################################################+--+##.----------+++-\n+---......---++++######+#############################################+######+####-....--..........--\n+++++-.-++----+#++#####++############+##########################################--.###++--++-.--++++\n#++++------+#+-++--.-##############################################################+++..-----.-+++++\n+-+++-.--++---++-----..-+########################################+####################--+----.--++++\n+--+-----------------..-+################################+############################+.-+---.---+++\n+..-...................-###############+###############++##############################--.......----\n++++++++++++--.----------#############+################+########################++####++------++++++\n+-+++++++++++-.---------.-###########++###############+#######################-.-######-##+-++++++++\n+-----+++++++-.----------.-##########--##############################++###+------+#####-.+#+--++++-+\n+---------+---.-------------#########-+++###############+#############------------#####+-.------+++-\n+----........................+#####++++##############+-....-+#########+++-........#######++-......--\n+++++-.-------+++++++---------..+++###############+.----------...+######.----.-----######+--.-++++++\n+++++----------++++++-.-----.--###################...---++++++++--######++++------.#########-.--++++\n+-+++-.----------++++-.--.-#######################+-------++++++--+#####+------+++--+#####+-.----+++\n+----------------------+#######################+-..----------++----#######--------+---..-----.------\n+------------..---..-###################+++####-...------......-...+#######--.................------\n+--+++++++++--.---+#################---++####+-.-----+++++++-.-----.-#####-.-+++++++-.-++++++++++++-\n#---+++++++++-.-###############-...-########+---------++++++-.-------......--+++++++-.----+++++++++-\n#------+++--+##############+------+#########+.----------++++------------------++++++-.------+++++++-\n+----------######+#######---------#######++--.----------------------------------++++-.----+-----+++-\n+---......+#+##++######--.......-########+++--..-..............................................-----\n+++++-.---.-+##+####+.--+-------#######+--++++++++++-.         BUGCAT CODEX: COMPLETE        .-+++++\n+-+++-.--------..-----.-----+-+#######-.---+++++++++-. [reentrancy] [predictable] [overflow] .--++++\n+--++------------++++-.------+#######+---------+++++-.      [unprotected] [misspelled]       .---+++\n+-----.---------------.----+########+.---------------.          All wounds witnessed.        .------\n+------------..-------.+###########-..........................................--.............-------\n++-++++++++++-.---+--.############-.--++++++-.---+++++++++++-.-----+++++++++---+++++++++++++++++++++\n#+--+++++++++-.------.##########-.---+++++++-.-------+++++++-.-------+++++++---+++++----++++++++++++\n#+--+++++++++-.----++----++-------+++--------.---------++++--.----------++++---++++-------++++++++++";

  const specialCodeDark = "-+---+#++++++++-----++#+++-++++-----++++++++--------+#+++++++---+++#+. .......+###++++------+#+++---\n-+---+#++++++#+++---++#++++++++++--++#+#-++++++++++-+#+++++++++--++##. .   .  +#+..++++++---+#++++++\n-+++++##++++#-..-##########+++++++++++.. .+++++++++++#+++++++++..-###-   ..   +####+...+++++###+++++\n-++---+++++++- ...-++++++++++#+++++#-.... -#+++++++++++++++++#+++++-.. ...    +--##+-+++++++++++++++\n.++--------++-...--.-#+++++++#++++-...--.. #++++++++--------+#+--++...     .++#++++++#++++++++------\n.++++++-----+-...---. -+++++----+..+.....  ++++++++++++++++++++---+##. ..  .  +++-+++#+----+++++----\n-++++++++++++- ...-+....... .  ...--.....  ++++++++++++++++++---+#+.... .........---+#+++++++++++---\n-############+. ..-.. .. .... .-...-+--.-. ++####+#####+..+--##+.......  ...-##############+++++++++\n-----+#+++++++....  .. ........... ......  .+##+#..---.......++- ....--....++----+--++-++++++#+++-++\n-----+#+++++++-..  .  .... ...-........ ....++++-..     ....... ...---.-++#-..-+++++--------+#+-----\n-++--+#+++++++. ..       ......  ........  . ...--  ..... .. .-... ..-....-.....-++-...-----+++-----\n-++--+#+++++#-  .... .   ..    ...   ..  . ...    .  .....       .....  ...++--------+++--+++#++----\n-++++####+##+. .-+.#-   .    .+.++-...  ......    ........      .-..  .....----.-++++##+++++###+++++\n-++------++++.  -+.-+.  ..  .+-..-+...   .....  . .......    ....      ........ .++---++++++++++++++\n-+++------+++.   .---. .... .-+++-   ........  ....  .......     ..    .....  .--++...-+++++++------\n-+++-++---++++ ..............  ...  ... .....  ....-.........  ....  ...  .  -#-..+++#+++++++++-----\n-++++++----------.  .-+++- .  ........  ...  . ..... ....   ...    ....  ..    -++-..#++++++++++---+\n-+++######+++----.... .-...................  .  ...  .... ..  ...  ..-......-... +####++##########++\n-----+#+--++++-.--.....--... ........-.  .      ....... . ..  ..     ..... ..  .++#...--++--+#++----\n.----++++++-.-+--++#+... ...    .....   .     ..  .      .......          .........---##+++++#+-----\n-+---+#++--+++--+++++##+-......   ....        ... ..... .....   .-.      ..  .... ....++-++++#++----\n-++-+++++++++++++++++##+-.             .       .... ..  .-..            ....  .  .....-#+-+++#+++---\n-##+###################+...  .  ..    .-.  .....   ....--.. .. ...        .  ....     .++#######++++\n------------++#++++++++++... ... .   .-. .......  ... .-. ....     .....     ...--.   --++++++------\n-+-----------+#+++++++++#+...........--.... ..      ..-.  ..     ..     ... ..+#+.  ...+..-+--------\n-+++++-------+#++++++++++#+........ .++. ..        ....   .      .. .--...-++++++-.   .+#-.-++----+-\n-+++++++++-+++#+++++++++++++. ..    .+---...  ......  ..-.....  .    .++++++++++++ ... -+#++++++---+\n-++++########################-.  ..----....  .  .....-+####+-.   ... .---+########.    ..--+######++\n-----+#+++++++-------+++++++++##---...   ...   .. -#++++++++++###-  .  .#++++#+++++     .-++#+------\n-----++++++++++------+#+++++#++. ..... ...    ....###+++--------++..   .----++++++#.  ... ..+#++----\n-+---+#++++++++++----+#++#+.. . ..........  ......-+++++++------++-.    -++++++---++-   ..-+#++++---\n-++++++++++++++++++++++-...         . .. ......-+##++++++++++--++++.   ...++++++++-+++##+++++#++++++\n-++++++++++++##+++##+............ ......---....+###++++++######+###-   ....++#################++++++\n-++---------++#+++-....     .   ....+++--. . -+#+++++-------+#+++++#+.. ..+#+-------+#+------------+\n.+++---------+#+.  .. ... .. ..+###+..     .-+++++++++------+#+++++++######++-------+#++++---------+\n.++++++---++-........  .  .-+++++++.....   .-#++++++++++----++++++++++++++++++------+#++++++-------+\n-++++++++++......- .    .+++++++++. ..  .--+##++++++++++++++++++++++++++++++++++----+#++++-+++++---+\n-+++######-.-. --.  ...++#######+.....  .---++##+##############################################+++++\n-----+#+++#+-..-.. .-#++-+++++++ .. .  -++----------+#         BUGCAT CODEX: COMPLETE        #+----+\n-+---+#++++++++##+++++#+++++-+-....  .+#+++---------+# [reentrancy] [predictable] [overflow] #++----\n-++--++++++++++++----+#++++++-..   ..-+++++++++-----+#      [unprotected] [misspelled]       #+++---\n-+++++#+++++++++++++++#++++-.    ...-#+++++++++++++++#          All wounds witnessed.        #++++++\n-++++++++++++##+++++++#-.... .   ..+##########################################++#############+++++++\n--+----------+#+++-++#............+#++------+#+++-----------+#+++++---------+++---------------------\n.-++---------+#++++++#.......  .+#+++-------+#+++++++-------+#+++++++-------+++-----++++------------\n.-++--------++#++++--++++--+++++++---++++++++#+++++++++----++#++++++++++----+++----+++++++----------";

  // Deploy BugcatCodexRenderer first
  console.log("\nüì¶ Deploying BugcatCodexRenderer...");
  const BugcatCodexRenderer = await ethers.getContractFactory("BugcatCodexRenderer", {
    libraries: {
      "ENSResolver": "0x0000000000000000000000000000000000000000" // TODO: Replace with actual deployed library address
    }
  });
  
  // Sepolia BugcatsRegistry address provided by user
  const BUGCATS_REGISTRY_ADDRESS = "0x9EfBD2718337343330E89d599C5cDeF78E236432";
  
  const renderer = await BugcatCodexRenderer.deploy(BUGCATS_REGISTRY_ADDRESS, specialCodeLight, specialCodeDark);
  await renderer.waitForDeployment();
  
  const rendererAddress = await renderer.getAddress();
  console.log("‚úÖ BugcatCodexRenderer deployed to:", rendererAddress);

  // Deploy BugcatCodex
  console.log("\nüì¶ Deploying BugcatCodex...");
  const BugcatCodex = await ethers.getContractFactory("BugcatCodex");
  
  // Constructor parameters: owner, bugcatRegistry, bugcatCount, renderer, royaltyReceiver
  const owner = deployer.address;
  const bugcatCount = 5; // Adjust this based on your needs
  const royaltyReceiver = deployer.address; // You can change this to a different address
  
  const codex = await BugcatCodex.deploy(
    deployer.address,
    BUGCATS_REGISTRY_ADDRESS,
    bugcatCount,
    rendererAddress,
    royaltyReceiver
  );
  await codex.waitForDeployment();
  
  const codexAddress = await codex.getAddress();
  console.log("‚úÖ BugcatCodex deployed to:", codexAddress);

  // Summary
  console.log("\nüéâ Deployment Summary:");
  console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");
  console.log("üìã BugcatCodexRenderer:", rendererAddress);
  console.log("üìã BugcatCodex:", codexAddress);
  console.log("üåê Network: Sepolia (Chain ID: 11155111)");
  console.log("üë§ Deployer:", deployer.address);
  console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");

  // Save deployment info
  const deploymentInfo = {
    network: "sepolia",
    chainId: 11155111,
    deployer: deployer.address,
    contracts: {
      BugcatCodexRenderer: rendererAddress,
      BugcatCodex: codexAddress
    },
    timestamp: new Date().toISOString()
  };

  const fs = require('fs');
  fs.writeFileSync(
    './deployment-sepolia.json', 
    JSON.stringify(deploymentInfo, null, 2)
  );
  
  console.log("üíæ Deployment info saved to deployment-sepolia.json");
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error("‚ùå Deployment failed:", error);
    process.exit(1);
  });
